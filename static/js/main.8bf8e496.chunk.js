(this["webpackJsonperror-issue-tracker-github-firebase-app"]=this["webpackJsonperror-issue-tracker-github-firebase-app"]||[]).push([[0],{157:function(e,t,r){},168:function(e,t,r){},250:function(e,t,r){"use strict";r.r(t);var n=r(0),c=r.n(n),a=r(43),s=r.n(a),i=(r(157),r(158),r(47)),o=r(22),u=r.n(o),l=r(31),d=r(32),h=r(254),b=r(94),j=r(55),p=r(72),f=r(260),O=r(257),m=r(258),x=r(256),v=r(259),g=r(255),w=r(261),y=r(134),k=(r(168),r(41)),I=r(76),S=r(74);S.a.initializeApp({apiKey:"AIzaSyDztHbGZPPKgBwaG99oGrOn43EleWbWSy4",authDomain:"fir-error-issue-tracker.firebaseapp.com",projectId:"fir-error-issue-tracker",storageBucket:"fir-error-issue-tracker.appspot.com",messagingSenderId:"236147115157",appId:"1:236147115157:web:157eebf20a51e427ba079c",measurementId:"G-CLSCGJD641"});var C=S.a.firestore(),N=function(){function e(){Object(k.a)(this,e),this.ref=void 0,this.ref=C.collection("trackedErrors")}return Object(I.a)(e,[{key:"save",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("id"in t)){e.next=4;break}return e.next=3,this.ref.doc(t.id).set(t);case 3:return e.abrupt("return",t);case 4:return e.next=6,this.ref.add(t);case 6:return r=e.sent,e.abrupt("return",Object(i.a)(Object(i.a)({},t),{},{id:r.id}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onRead",value:function(e,t){return this.ref.where("projectId","==",e).onSnapshot((function(e){var r=[];e.forEach((function(e){r.push(Object(i.a)(Object(i.a)({},e.data()),{},{id:e.id}))})),t(r)}))}},{key:"fetch",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ref.where("projectId","==",t);case 2:return e.next=4,e.sent.get();case 4:return r=e.sent.docs,e.abrupt("return",r.map((function(e){var t=e.data();return Object(i.a)(Object(i.a)({},t),{},{id:e.id})})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ref.doc(t.id).delete();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),F=new S.a.auth.GithubAuthProvider;F.addScope("repo");var G=function(){var e=Object(l.a)(u.a.mark((function e(){var t,r,n,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(r=D())){e.next=4;break}return e.abrupt("return",r);case 4:return e.next=6,S.a.auth().getRedirectResult();case 6:if(n=e.sent,c=null===n||void 0===n||null===(t=n.credential)||void 0===t?void 0:t.accessToken,!n.user||!c){e.next=12;break}return a={displayName:n.user.displayName||n.user.email,githubToken:c,photoUrl:n.user.photoURL},window.localStorage.setItem("currentUser",JSON.stringify(a)),e.abrupt("return",a);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",void 0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.a.auth().signInWithRedirect(F);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.localStorage.removeItem("currentUser"),e.next=3,S.a.auth().signOut();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=window.localStorage.getItem("currentUser");return e?JSON.parse(e):void 0},A=r(145),P=function(){function e(t){Object(k.a)(this,e),this.octokit=void 0,this.octokit=new A.a({auth:t})}return Object(I.a)(e,[{key:"getRepositories",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.octokit.repos.listForAuthenticatedUser();case 2:return t=e.sent,r=t.data,e.abrupt("return",r.map((function(e){var t;return{name:e.name,owner:(null===(t=e.owner)||void 0===t?void 0:t.login)||e.full_name.split("/")[0],fullName:e.full_name}})));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createIssue",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r,n,c,a,s,i,o,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projectId.split("/"),n=Object(d.a)(r,2),c=n[0],a=n[1],e.next=3,this.octokit.issues.create({owner:c,repo:a,title:t.name,body:"Found ".concat(t.newOccurrences.length," occurences for the error ").concat(t.name)});case 3:return s=e.sent,i=s.data,o=i.number,l=i.html_url,e.abrupt("return",{id:o.toString(),url:l});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateIssue",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r,n,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projectId.split("/"),n=Object(d.a)(r,2),c=n[0],a=n[1],e.next=3,this.octokit.issues.createComment({owner:c,repo:a,issue_number:parseInt(t.issue.id),body:"Hey, I found ".concat(t.newOccurrences.length," occurrence(s) : \n- ").concat(t.newOccurrences.map((function(e){return e.message})).join("\n - "))});case 3:return e.abrupt("return",t.issue);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closeIssue",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var r,n,c,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projectId.split("/"),n=Object(d.a)(r,2),c=n[0],a=n[1],e.next=3,this.octokit.issues.update({owner:c,repo:a,issue_number:parseInt(t.issue.id),state:"closed"});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),L=r(13),R=h.a.Header,U=h.a.Content,z=h.a.Footer,W=b.a.Option,J=new N,_={wrapperCol:{offset:8,span:16}},B={display:"flex",alignItems:"center",justifyContent:"center"},H=function(e){return e&&new P(e.githubToken)};var K=function(){var e=Object(n.useState)(),t=Object(d.a)(e,2),r=t[0],c=t[1],a=Object(n.useState)([]),s=Object(d.a)(a,2),o=s[0],k=s[1],I=Object(n.useState)(),S=Object(d.a)(I,2),C=S[0],N=S[1],F=Object(n.useState)(),D=Object(d.a)(F,2),A=D[0],P=D[1],K=Object(n.useState)(),q=Object(d.a)(K,2),M=q[0],V=q[1],Z=Object(n.useState)(!1),Q=Object(d.a)(Z,2),X=Q[0],Y=Q[1],$=function(e){return k(e.map((function(e){return{id:e.id,name:e.name,issue:e.issue,newOccurrences:e.newOccurrences.length,totalOccurrences:e.occurrences.length+e.newOccurrences.length,source:e}})))};Object(n.useEffect)((function(){return C||(Y(!0),G().then((function(e){N(e),Y(!1)}))),M?J.onRead(M,$):function(){}}),[C,M]),Object(n.useEffect)((function(){var e;!A&&(null===(e=H(C))||void 0===e||e.getRepositories().then(P))}),[C,A]);var ee=function(){var e=Object(l.a)(u.a.mark((function e(t){var r,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=H(C))&&M){e.next=3;break}throw new Error("Need to be login to use this feature");case 3:n={database:J,issueClient:r,projectId:M},Object(y.trackErrors)([{message:t["error-message"],timestamp:(new Date).getTime()}],n).catch((function(e){return c(e.message)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=[{title:"Name",dataIndex:"name",key:"name"},{title:"Github issue",dataIndex:"issue",key:"issue",render:function(e){var t=e.id,r=e.url;return Object(L.jsx)("a",{href:r,children:t})}},{title:"New occurrences",dataIndex:"newOccurrences",key:"newOccurrences"},{title:"Total occurences",dataIndex:"totalOccurrences",key:"totalOccurrences"},{title:"Action",key:"action",render:function(e,t){return Object(L.jsx)(j.a,{type:"link",onClick:function(){return J.delete(t.source).then((function(){var e;return null===(e=H(C))||void 0===e?void 0:e.closeIssue(t.source)}))},children:"Close and delete"})}}];return Object(L.jsxs)(h.a,{className:"layout",children:[Object(L.jsxs)(R,{children:[Object(L.jsx)("div",{className:"logo",children:"Demo Error Issue Tracker"}),Object(L.jsx)(p.a,{theme:"dark",mode:"horizontal",selectable:!1,style:{float:"right"},children:C?Object(L.jsx)(p.a.Item,{icon:Object(L.jsx)(f.a,{src:Object(L.jsx)(O.a,{src:C.photoUrl})}),onClick:function(){return E().then((function(){return N(void 0)}))},children:"Log out"},"logout"):Object(L.jsx)(p.a.Item,{icon:Object(L.jsx)(w.a,{}),onClick:T,children:"Log in with Github"},"login")})]}),Object(L.jsxs)(U,{className:"site-layout-content",children:[Object(L.jsxs)("div",{children:[Object(L.jsxs)("h1",{style:{textAlign:"center"},children:["Welcome to the demo of the"," ",Object(L.jsx)("a",{href:"https://github.com/ludorival/error-issue-tracker",children:"error-issue-tracker-sdk !"})]}),Object(L.jsx)("div",{style:B,children:Object(L.jsxs)("div",{children:[Object(L.jsxs)("p",{children:[" ","This demo shows you an usage of the"," ",Object(L.jsx)("a",{href:"https://github.com/ludorival/error-issue-tracker",children:"error-issue-tracker-sdk !"}),Object(L.jsxs)("p",{children:["It is based on"," ",Object(L.jsxs)("ul",{children:[Object(L.jsxs)("li",{children:[Object(L.jsx)("b",{children:Object(L.jsx)("a",{href:"https://octokit.github.io/rest.js/v18/",children:"Github SDK"})})," ","to track the issues"]}),Object(L.jsxs)("li",{children:[Object(L.jsx)("b",{children:Object(L.jsx)("a",{href:"https://firebase.google.com/docs/reference/js",children:"Firebase"})})," ","to store the mapping between the errors and the relative issues."]})]})]})]}),Object(L.jsxs)("p",{children:["This demo uses your Github account to list your repository"," ",Object(L.jsx)("i",{children:"(None of your personnal data will be stored)"}),".",Object(L.jsxs)("ul",{children:[Object(L.jsx)("li",{children:"Select a repository where the errors should be tracked"}),Object(L.jsx)("li",{children:"Write and push a message to simulate an error to track"}),Object(L.jsx)("li",{children:"Try by putting the same error and you will see that the same issue will be recycled"})]})]})]})})]}),Object(L.jsx)("hr",{}),C?Object(L.jsxs)(n.Fragment,{children:[Object(L.jsxs)(x.a,{style:{padding:16},labelCol:{span:8},wrapperCol:{span:8},name:"basic",initialValues:{remember:!0},onFinish:ee,onFinishFailed:function(e){console.log("Failed:",e)},children:[Object(L.jsx)(x.a.Item,{name:"repository",label:"Github repository",rules:[{required:!0}],children:Object(L.jsx)(b.a,{showSearch:!0,style:{width:200},placeholder:"Select a repository",onChange:function(e){return V(e.toString())},children:null===A||void 0===A?void 0:A.map((function(e){return Object(L.jsx)(W,{value:e.fullName,children:e.name},e.fullName)}))})}),Object(L.jsx)(x.a.Item,{label:"Enter an example of error",name:"error-message",validateStatus:r?"error":void 0,help:r,rules:[{required:!0,message:"Please input a message!"}],children:Object(L.jsx)(v.a,{})}),Object(L.jsx)(x.a.Item,Object(i.a)(Object(i.a)({},_),{},{children:Object(L.jsx)(j.a,{type:"primary",htmlType:"submit",children:"Push"})}))]}),Object(L.jsx)(g.a,{dataSource:o,columns:te})]}):X?Object(L.jsx)(m.a,{active:!0}):Object(L.jsxs)("div",{style:Object(i.a)(Object(i.a)({},B),{},{flexDirection:"column"}),children:[Object(L.jsx)("div",{style:{fontWeight:800,padding:24,fontSize:"2em"},children:"Let's get started ! \ud83d\udc47"}),Object(L.jsx)(j.a,{type:"primary",size:"large",icon:Object(L.jsx)(w.a,{}),onClick:T,children:"Log in with Github"})]})]}),Object(L.jsxs)(z,{style:{textAlign:"center"},children:["Ant Design \xa92018 Created by Ant UED",Object(L.jsx)("p",{children:Object(L.jsx)("a",{href:"https://www.termsfeed.com/live/269deb2a-4a39-4ce1-8bd2-3a4f1c3bbf54",children:"Private Policy"})})]})]})},q=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,262)).then((function(t){var r=t.getCLS,n=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;r(e),n(e),c(e),a(e),s(e)}))};s.a.render(Object(L.jsx)(c.a.StrictMode,{children:Object(L.jsx)(K,{})}),document.getElementById("root")),q()}},[[250,1,2]]]);
//# sourceMappingURL=main.8bf8e496.chunk.js.map